(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();class ie{constructor(){this.animations=new Map,this.isPaused=!0}addElement(t,n,i,a=.5){this.animations.set(t,{delay:n,duration:a,remainingDelay:n-i,isPending:!1}),t.style.animationDuration=`${a}s`}removeElement(t){const n=this.animations.get(t);typeof n>"u"||(n.isPending&&clearTimeout(n.startTimeout),this.animations.delete(t))}setAnimationTimeout(t,n){t.startTimeout=setTimeout(()=>{n.nodeName=="LI"?(n.classList.remove("text-zinc-400"),n.classList.add("text-zinc-100"),t.remainingDelay>=0&&n.scrollIntoView({behavior:"smooth",block:"start"})):n.nodeName=="SPAN"&&(t.remainingDelay>=0&&(n.style.animationName="word-gradient",n.style.animationPlayState="running"),n.classList.add("actived")),t.isPending=!1},t.remainingDelay*1e3)}clearCompletion(t,n,i){t.isPending=!0,n.nodeName=="LI"&&i<t.delay?(n.classList.remove("text-zinc-100"),n.classList.add("text-zinc-400")):n.nodeName=="SPAN"&&i<t.delay+t.duration&&(n.classList.remove("actived"),n.style.animationName="")}play(t,n){this.isPaused&&(this.animations.forEach((i,a)=>{i.remainingDelay=(i.delay-t)*n,a.style.animationDuration=`${i.duration*n}s`,this.clearCompletion(i,a,t),this.setAnimationTimeout(i,a)}),this.isPaused=!1)}pause(){this.isPaused||(this.isPaused=!0,this.animations.forEach((t,n)=>{n.style.animationPlayState="paused",t.isPending&&clearTimeout(t.startTimeout)}))}refresh(t,n){this.isPaused||this.animations.forEach((i,a)=>{i.isPending&&clearTimeout(i.startTimeout),i.remainingDelay=(i.delay-t)*n,a.style.animationDuration=`${i.duration*n}s`,this.clearCompletion(i,a,t),this.setAnimationTimeout(i,a)})}}function p(e,t=!0){const n=Math.floor(e/60),i=(e%60).toFixed(3);return t?`${n.toString().padStart(2,"0")}:${i.toString().padStart(6,"0")}`:`${n}:${Math.floor(i).toString().padStart(2,"0")}`}function R(e){let t=0;return e.split(":").reverse().forEach((n,i)=>{t+=parseFloat(n)*60**i}),t}function ae(e,t,n){let i=`[by:Generated using LySy]
`;return e.forEach(a=>{const c=a.dataset.time;if(!(typeof c>"u")){if(a.dataset.type=="normal"?(i+=`[${p(c)}]`,n&&(i+=a.dataset.vocalist==1?"v1:":"v2:")):i=i.slice(0,-1)+" [bg:",t){const u=Array.from(a.children[0].children);i+=`<${p(c)}>`,u.forEach((h,I)=>{const g=`<${p(h.dataset.beginTime)}>`;i.endsWith(g)||(i+=g),i+=h.innerText,h.dataset.type=="word"&&I+1!=u.length&&(i+=" "),i+=`<${p(h.dataset.endTime)}>`})}else i+=`${a.children[0].innerText}`;a.dataset.type=="bg"&&(i+="]"),i+=`
`}}),i}const se="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M200-200h57l391-391-57-57-391%20391v57Zm-80%2080v-170l528-527q12-11%2026.5-17t30.5-6q16%200%2031%206t26%2018l55%2056q12%2011%2017.5%2026t5.5%2030q0%2016-5.5%2030.5T817-647L290-120H120Zm640-584-56-56%2056%2056Zm-141%2085-28-29%2057%2057-29-28Z'/%3e%3c/svg%3e",L=document.getElementById("file"),de=document.getElementById("removeSongBtn"),d=document.getElementById("audio"),x=document.getElementById("playPauseBtn"),D=document.getElementById("seekBar"),k=document.getElementById("player"),U=document.getElementById("fileChooser"),re=document.getElementById("currentTime"),ce=document.getElementById("duration"),F=document.getElementById("isWordByWord"),M=document.getElementById("isCharByChar"),q=document.getElementById("isDuet"),w=document.getElementById("switchVocalistBtn"),P=document.getElementById("wordEndBtn");let o=F.checked,C=M.checked,b=q.checked;const j=/^[\u0590-\u08FF\uFB1D-\uFDFD\uFE70-\uFEFC]/;F.addEventListener("change",e=>{o=e.target.checked,s.length!=0&&N(),C&&!o&&M.click(),v(w,b,o?2:1),v(P,o,1)});M.addEventListener("change",e=>{C=e.target.checked,C&&!o&&F.click()});function v(e,t,n=1){e.classList.remove("bottom-[-2rem]","bottom-16","bottom-32"),t?e.classList.add(n==1?"bottom-16":"bottom-32"):e.classList.add("bottom-[-2rem]")}v(w,b,o?2:1);v(P,o,1);q.addEventListener("change",e=>{b=e.target.checked,s.length!=0&&N(),v(w,b,o?2:1),v(P,o,1)});function H(){const e=L.files[0];if(e){const t=URL.createObjectURL(e);d.src=t,U.classList.add("hidden"),k.classList.remove("hidden"),k.classList.add("flex")}}H();L.addEventListener("change",H);de.addEventListener("click",()=>{k.classList.remove("flex"),k.classList.add("hidden"),U.classList.remove("hidden"),d.pause()});const oe=document.getElementById("backwardBtn");oe.addEventListener("click",()=>{d.currentTime-=6*d.playbackRate,l.refresh(d.currentTime,1/d.playbackRate)});const le=document.getElementById("forwardBtn");le.addEventListener("click",()=>{d.currentTime+=5*d.playbackRate,l.refresh(d.currentTime,1/d.playbackRate)});d.addEventListener("timeupdate",()=>{D.value=d.currentTime/d.duration*100,re.textContent=p(d.currentTime,!1)});d.addEventListener("loadedmetadata",()=>{ce.textContent=p(d.duration,!1)});D.addEventListener("input",()=>{d.currentTime=D.value/100*d.duration,l.refresh(d.currentTime,1/d.playbackRate)});x.addEventListener("click",()=>{d.paused?d.play():d.pause()});const l=new ie,me=document.getElementById("lyricInput"),ue=document.getElementById("plainInputParser"),W=document.getElementById("lyricList"),V=document.getElementById("nextItemBtn"),Z=document.getElementById("prevItemBtn"),fe=document.getElementById("editItemModal"),E=document.getElementById("editItemContent"),f=document.getElementById("editItemInput"),he=document.getElementById("editItemRemove"),pe=document.getElementById("editItemDone"),A=document.getElementById("editItemIndex"),K=document.getElementById("addItemAboveBtn"),X=document.getElementById("addItemBelowBtn"),$=document.getElementById("markAsBg");let s=[],r=-1,m=-1;function y(e,t){const n=["text-zinc-100","cursor-pointer","border-zinc-900","bg-zinc-800","border-b-2"],i=["border-orange-400","border-1","rounded-b-2xl"],a=["border-zinc-800","border-b-2","text-zinc-400"];e.classList.remove(...n,...i,...a),t=="active"?e.classList.add(...n):t=="selected"?e.classList.add(...i):t=="normal"&&e.classList.add(...a)}function T(e){e.scrollIntoView({behavior:"smooth",block:"start"})}function G(e){const t=document.createElement("span");return t.innerText=e,t.classList.add("word"),j.test(e)&&t.classList.add("rtl"),t.dataset.type="part",t}function ye(e,t){Array.from(e).forEach(n=>{if(n!=""){if(/\W/.test(n)){t.lastChild.innerText+=n;return}t.appendChild(G(n))}})}function Y(e,t){e.split(" ").forEach(n=>{n!=""&&(n.split(/(-)|<>/).forEach(i=>{if(!(typeof i>"u"||i=="")){if(i=="-"){t.lastChild.innerText+=i;return}t.appendChild(G(i))}}),t.lastChild.dataset.type="word",t.innerHTML+=" ")})}function B(e=null){const t=document.createElement("input");return t.classList.add("h-8","outline-none","rounded-md","p-1","transition-all","ease-in-out","duration-300","border-2","focus:border-orange-400"),e!=null&&(t.dataset.type=e),t}function ge(e){const t=document.createElement("div");t.classList.add("w-full","flex","gap-2","my-2","mx-1");const n=B();n.classList.add("w-22","bg-zinc-800","text-zinc-100","border-zinc-800","text-center","text-sm"),n.value=p(e.dataset.beginTime),t.appendChild(n);const i=B(e.dataset.type);i.value=e.innerText,i.setAttribute("dir","auto"),i.dataset.type=e.dataset.type,i.classList.add("grow","min-w-28","bg-zinc-900","text-zinc-100","border-zinc-700",i.dataset.type=="word"?"text-start":"text-end"),t.appendChild(i);const a=B();return a.classList.add("w-22","bg-zinc-800","text-zinc-100","border-zinc-800","text-center","text-sm"),a.value=p(e.dataset.endTime),t.appendChild(a),t}function J(e,t=!1){const n=document.createElement("li"),i=document.createElement("p"),a=document.createElement("img");if(n.dataset.type=t?"bg":"normal",n.classList.add("flex",t?"py-2":"py-4","px-5","gap-2","text-zinc-400","items-center","rounded","first:rounded-t-2xl","last:rounded-b-2xl","border-b-2","border-zinc-800","duration-300","ease-out","transition-all","scroll-mt-[20svh]"),o){if(e.trim()=="")return;C?ye(e,i):Y(e,i)}else i.innerText=e;return b&&(n.dataset.vocalist=1),i.classList.add("grow",t?null:"text-2xl","transition-all","duration-300"),j.test(e)&&i.setAttribute("dir","rtl"),a.classList.add("mx-2","cursor-pointer"),a.src=se,a.width=20,a.addEventListener("click",c=>{c.stopPropagation();const u=c.currentTarget.previousElementSibling,h=s.indexOf(c.currentTarget.parentNode);let I="";if(E.innerHTML="",o){E.appendChild(f);const g=typeof u.lastElementChild.dataset.endTime<"u";Array.from(u.children).forEach(z=>{if(I+=z.innerText,I+=z.dataset.type=="word"?" ":"<>",g){const ne=ge(z);E.appendChild(ne)}}),f.value=I.trimEnd()}else{if(typeof u.parentElement.dataset.time<"u"){const g=B();g.classList.add("w-24","my-2","mx-1","text-center","bg-zinc-800","text-zinc-100","border-zinc-800"),g.value=p(u.parentElement.dataset.time),E.appendChild(g)}f.value=u.innerText,E.appendChild(f)}$.checked=u.parentElement.dataset.type=="bg",K.disabled=h<=r,X.disabled=h<r,f.disabled=o&&h<r,fe.showModal(),A.value=h,f.focus()}),n.appendChild(i),n.appendChild(a),n}function N(){const e=me.value;W.innerHTML="",s=[],r=-1,e.split(`
`).forEach(n=>{if(o&&n.trim()=="")return;const i=J(n);W.appendChild(i),s.push(i)}),document.getElementById("syncer").classList.remove("hidden"),T(s[0]),o&&y(s[0],"selected"),v(V,!0,1),v(Z,!0,2)}ue.addEventListener("click",N);function O(e,t){e.dataset.time=t,e.addEventListener("click",()=>{typeof e.dataset.time>"u"||(d.currentTime=e.dataset.time,l.refresh(d.currentTime,1/d.playbackRate))})}P.addEventListener("click",()=>{const e=s[r].children[0],t=e.children[m];typeof t?.dataset?.beginTime>"u"||(t.dataset.endTime=d.currentTime,m+1>=e.childElementCount&&(y(s[r],"active"),r<=s.length-1&&(m=-1,r++,r!=s.length&&(y(s[r],"selected"),T(s[r])))))});function Q(){const e=d.currentTime;if(o){if(r==-1&&(r++,m=-1),r==s.length)return;const t=s[r].children[0].children[m];m++,m>=s[r].children[0].childElementCount&&(y(s[r],"active"),r<=s.length-1&&(m=0,r++,r!=s.length&&(y(s[r],"selected"),T(s[r]))));const n=s[r],a=n.children[0].children[m];if(a.dataset.beginTime=e,a.classList.add("actived"),m==0&&(O(n,e),l.addElement(n,Number(n.dataset.time),d.currentTime)),typeof t<"u"){const c=t.dataset;typeof c.endTime>"u"&&(c.endTime=e),l.addElement(t,Number(c.beginTime),d.currentTime,Number(c.endTime)-Number(c.beginTime))}}else if(r<s.length-1){r++;const t=s[r];y(t,"active"),T(t),O(t,e),l.addElement(t,Number(t.dataset.time),d.currentTime)}}function S(e){l.removeElement(e),delete e.dataset.time,o&&Array.from(e.children[0].children).forEach(t=>{typeof t?.dataset?.beginTime>"u"||(typeof t?.dataset?.endTime<"u"&&l.removeElement(t),delete t.dataset.beginTime,delete t.dataset.endTime,t.classList.remove("actived"),t.style.animationName="")})}function _(){if(r<0)return;const e=s[r];if(o)if(m==-1&&r!=0){const t=s[r-1];y(t,"selected"),T(t),d.currentTime=Math.max(0,t.dataset.time-1.5),S(t),r!=s.length&&y(e,"normal"),r--}else m!=-1&&(d.currentTime=Math.max(0,e.dataset.time-1.5),S(e),m=-1);else{const t=s[r-1];r--,T(r==-1?s[0]:t),d.currentTime=Math.max(0,e.dataset.time-1.5),y(e,"normal"),S(e)}l.refresh(d.currentTime,1/d.playbackRate)}window.addEventListener("keydown",e=>{e.code==="Space"&&!["INPUT","TEXTAREA"].includes(document.activeElement.nodeName)&&(e.preventDefault(),e.shiftKey?_():L.files.length==0?L.click():s.length==0?N():Q())});V.addEventListener("click",Q);Z.addEventListener("click",_);function ee(e){e.dataset.vocalist==1?(e.dataset.vocalist=2,e.children[0].classList.remove("text-start"),e.children[0].classList.add("text-end")):(e.dataset.vocalist=1,e.children[0].classList.remove("text-end"),e.children[0].classList.add("text-start"))}w.addEventListener("click",()=>{s.length!=0&&s.slice(Math.max(0,r)).forEach(e=>{ee(e)})});document.getElementById("playbackSpeed").addEventListener("change",e=>{d.playbackRate=e.target.selectedOptions[0].value,l.refresh(d.currentTime,1/d.playbackRate)});function te(e){const t=Number(A.value),n=J(f.value,$.checked);s[t].dataset.vocalist==2&&ee(n),e?(s[t].insertAdjacentElement("beforebegin",n),s.splice(t,0,n)):(s[t].insertAdjacentElement("afterend",n),s.splice(t+1,0,n))}K.addEventListener("click",()=>te(!0));X.addEventListener("click",()=>te(!1));he.addEventListener("click",()=>{const e=A.value;s[e].classList.add("hidden"),s.splice(e,1),r>=e&&(r--,r==e-1&&(m=99))});pe.addEventListener("click",()=>{const e=A.value;if(o)f.disabled?(Array.from(E.children).forEach((t,n)=>{if(t.nodeName=="TEXTAREA")return;const i=s[e].children[0].children[n-1];l.removeElement(i);const a=R(t.children[0].value),c=R(t.children[2].value);i.innerText=t.children[1].value,i.dataset.beginTime=a,i.dataset.endTime=c,l.addElement(i,a,d.currentTime,c-a)}),s[e].dataset.time=s[e].children[0].children[0].dataset.beginTime):(s[e].children[0].innerHTML="",Y(f.value,s[e].children[0]),m=-1);else{l.removeElement(s[e]),s[e].children[0].innerText=f.value;const t=R(E.children[0].value);s[e].dataset.time=t,l.addElement(s[e],t,d.currentTime)}$.checked?(s[e].dataset.type="bg",s[e].children[0].classList.remove("text-2xl","p-4"),s[e].classList.remove("py-4"),s[e].classList.add("py-2")):(s[e].dataset.type="normal",s[e].classList.remove("py-2"),s[e].classList.add("py-4"),s[e].children[0].classList.add("text-2xl"))});function ve(e,t){const n=new Blob([t]),i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}const Ee=document.getElementById("dlFile");Ee.addEventListener("click",()=>{if(L.files.length==0){alert("You need to select an input file first");return}const e=ae(s,o,b),n=L.files[0].name.replace(/(\.\w+?)?$/,".lrc");ve(n,e)});d.addEventListener("play",()=>{l.play(d.currentTime,1/d.playbackRate),x.firstElementChild.classList.add("hidden"),x.lastElementChild.classList.remove("hidden")});d.addEventListener("pause",()=>{l.pause(),x.firstElementChild.classList.remove("hidden"),x.lastElementChild.classList.add("hidden")});
