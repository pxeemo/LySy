(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function i(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(a){if(a.ep)return;a.ep=!0;const c=i(a);fetch(a.href,c)}})();class ie{constructor(){this.animations=new Map,this.isPaused=!0}addElement(e,i,n=.5){this.animations.set(e,{delay:i,duration:n,remainingDelay:i-audio.currentTime,isPending:!1}),e.style.animationDuration=`${n*1e3}ms`}removeElement(e){const i=this.animations.get(e);typeof i>"u"||(i.isPending&&clearTimeout(i.startTimeout),this.animations.delete(e))}setAnimationTimeout(e,i){e.startTimeout=setTimeout(()=>{i.nodeName=="LI"?(i.classList.remove("text-zinc-400"),i.classList.add("text-zinc-100"),e.remainingDelay>=0&&i.scrollIntoView({behavior:"smooth",block:"start"})):i.nodeName=="SPAN"&&(e.remainingDelay>=0&&(i.style.animationName="word-gradient",i.style.animationPlayState="running"),i.classList.add("actived")),e.isPending=!1},e.remainingDelay*1e3)}clearCompletion(e,i,n){e.isPending=!0,i.nodeName=="LI"&&n<e.delay?(i.classList.remove("text-zinc-100"),i.classList.add("text-zinc-400")):i.nodeName=="SPAN"&&n<e.delay+e.duration&&(i.classList.remove("actived"),i.style.animationName="")}play(){if(!this.isPaused)return;const e=1/audio.playbackRate,i=audio.currentTime;this.animations.forEach((n,a)=>{n.remainingDelay=(n.delay-i)*e,a.style.animationDuration=`${n.duration*1e3*e}ms`,this.clearCompletion(n,a,i),this.setAnimationTimeout(n,a)}),this.isPaused=!1}pause(){this.isPaused||(this.isPaused=!0,this.animations.forEach((e,i)=>{i.style.animationPlayState="paused",e.isPending&&clearTimeout(e.startTimeout)}))}refresh(){if(this.isPaused)return;const e=1/audio.playbackRate,i=audio.currentTime;this.animations.forEach((n,a)=>{n.isPending&&clearTimeout(n.startTimeout),n.remainingDelay=(n.delay-i)*e,a.style.animationDuration=`${n.duration*1e3*e}ms`,this.clearCompletion(n,a,i),this.setAnimationTimeout(n,a)})}}function p(t,e=!0){const i=Math.floor(t/60),n=(t%60).toFixed(3);return e?`${i.toString().padStart(2,"0")}:${n.toString().padStart(6,"0")}`:`${i}:${Math.floor(n).toString().padStart(2,"0")}`}function S(t){let e=0;return t.split(":").reverse().forEach((i,n)=>{e+=parseFloat(i)*60**n}),e}function ae(t,e,i){let n=`[by:Generated using LySy]
`;return t.forEach(a=>{const c=a.dataset.time;if(!(typeof c>"u")){if(a.dataset.type=="normal"?(n+=`[${p(c)}]`,i&&(n+=a.dataset.vocalist==1?"v1:":"v2:")):n=n.slice(0,-1)+" [bg:",e){const m=Array.from(a.children[0].children);n+=`<${p(c)}>`,m.forEach((h,I)=>{const y=`<${p(h.dataset.beginTime)}>`;n.endsWith(y)||(n+=y),n+=h.innerText,h.dataset.type=="word"&&I+1!=m.length&&(n+=" "),n+=`<${p(h.dataset.endTime)}>`})}else n+=`${a.children[0].innerText}`;a.dataset.type=="bg"&&(n+="]"),n+=`
`}}),n}const se="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M200-200h57l391-391-57-57-391%20391v57Zm-80%2080v-170l528-527q12-11%2026.5-17t30.5-6q16%200%2031%206t26%2018l55%2056q12%2011%2017.5%2026t5.5%2030q0%2016-5.5%2030.5T817-647L290-120H120Zm640-584-56-56%2056%2056Zm-141%2085-28-29%2057%2057-29-28Z'/%3e%3c/svg%3e",L=document.getElementById("file"),de=document.getElementById("removeSongBtn"),r=document.getElementById("audio"),T=document.getElementById("playPauseBtn"),F=document.getElementById("seekBar"),k=document.getElementById("player"),U=document.getElementById("fileChooser"),re=document.getElementById("currentTime"),ce=document.getElementById("duration"),M=document.getElementById("isWordByWord"),R=document.getElementById("isCharByChar"),q=document.getElementById("isDuet"),w=document.getElementById("switchVocalistBtn"),P=document.getElementById("wordEndBtn");let o=M.checked,C=R.checked,b=q.checked;const j=/^[\u0590-\u08FF\uFB1D-\uFDFD\uFE70-\uFEFC]/;M.addEventListener("change",t=>{o=t.target.checked,s.length!=0&&N(),C&&!o&&R.click(),g(w,b,o?2:1),g(P,o,1)});R.addEventListener("change",t=>{C=t.target.checked,C&&!o&&M.click()});function g(t,e,i=1){t.classList.remove("bottom-[-2rem]","bottom-16","bottom-32"),e?t.classList.add(i==1?"bottom-16":"bottom-32"):t.classList.add("bottom-[-2rem]")}g(w,b,o?2:1);g(P,o,1);q.addEventListener("change",t=>{b=t.target.checked,s.length!=0&&N(),g(w,b,o?2:1),g(P,o,1)});function H(){const t=L.files[0];if(t){const e=URL.createObjectURL(t);r.src=e,U.classList.add("hidden"),k.classList.remove("hidden"),k.classList.add("flex")}}H();L.addEventListener("change",H);de.addEventListener("click",()=>{k.classList.remove("flex"),k.classList.add("hidden"),U.classList.remove("hidden"),r.pause()});const oe=document.getElementById("backwardBtn");oe.addEventListener("click",()=>{r.currentTime-=6*r.playbackRate,l.refresh()});const le=document.getElementById("forwardBtn");le.addEventListener("click",()=>{r.currentTime+=5*r.playbackRate,l.refresh()});r.addEventListener("timeupdate",()=>{F.value=r.currentTime/r.duration*100,re.textContent=p(r.currentTime,!1)});r.addEventListener("loadedmetadata",()=>{ce.textContent=p(r.duration,!1)});F.addEventListener("input",()=>{r.currentTime=F.value/100*r.duration,l.refresh()});T.addEventListener("click",()=>{r.paused?r.play():r.pause()});const l=new ie,me=document.getElementById("lyricInput"),ue=document.getElementById("plainInputParser"),W=document.getElementById("lyricList"),V=document.getElementById("nextItemBtn"),Z=document.getElementById("prevItemBtn"),fe=document.getElementById("editItemModal"),v=document.getElementById("editItemContent"),f=document.getElementById("editItemInput"),he=document.getElementById("editItemRemove"),pe=document.getElementById("editItemDone"),A=document.getElementById("editItemIndex"),K=document.getElementById("addItemAboveBtn"),X=document.getElementById("addItemBelowBtn"),$=document.getElementById("markAsBg");let s=[],d=-1,u=-1;function E(t,e){const i=["text-zinc-100","cursor-pointer","border-zinc-900","bg-zinc-800"],n=["border-zinc-900","bg-orange-900","rounded-b-2xl"],a=["border-zinc-700","text-zinc-400"];t.classList.remove(...i,...n,...a),e=="active"?t.classList.add(...i):e=="selected"?t.classList.add(...n):e=="normal"&&t.classList.add(...a)}function x(t){t.scrollIntoView({behavior:"smooth",block:"start"})}function G(t){const e=document.createElement("span");return e.innerText=t,e.classList.add("word"),j.test(t)&&e.classList.add("rtl"),e.dataset.type="part",e}function ye(t,e){Array.from(t).forEach(i=>{if(i!=""){if(/\W/.test(i)){e.lastChild.innerText+=i;return}e.appendChild(G(i))}})}function Y(t,e){t.split(" ").forEach(i=>{i!=""&&(i.split(/(-)|<>/).forEach(n=>{if(n!=""){if(n=="-"){e.lastChild.innerText+=n;return}e.appendChild(G(n))}}),e.lastChild.dataset.type="word",e.innerHTML+=" ")})}function B(t=null){const e=document.createElement("input");return e.classList.add("h-8","outline-none","rounded-md","p-1","transition-all","ease-in-out","duration-300","border-2","focus:border-orange-400"),t!=null&&(e.dataset.type=t),e}function ge(t){const e=document.createElement("div");e.classList.add("w-full","flex","gap-2","my-2","mx-1");const i=B();i.classList.add("w-22","bg-zinc-800","text-zinc-100","border-zinc-800","text-center","text-sm"),i.value=p(t.dataset.beginTime),e.appendChild(i);const n=B(t.dataset.type);n.value=t.innerText,n.setAttribute("dir","auto"),n.dataset.type=t.dataset.type,n.classList.add("grow","min-w-28","bg-zinc-900","text-zinc-100","border-zinc-700",n.dataset.type=="word"?"text-start":"text-end"),e.appendChild(n);const a=B();return a.classList.add("w-22","bg-zinc-800","text-zinc-100","border-zinc-800","text-center","text-sm"),a.value=p(t.dataset.endTime),e.appendChild(a),e}function J(t,e=!1){const i=document.createElement("li"),n=document.createElement("p"),a=document.createElement("img");if(i.dataset.type=e?"bg":"normal",i.classList.add("flex","p-3","pl-4","gap-2","text-zinc-400","items-center","rounded","border-b-2","border-zinc-800","duration-500","ease-out","transition-all","scroll-mt-[20svh]"),o){if(t.trim()=="")return;C?ye(t,n):Y(t,n)}else n.innerText=t;return b&&(i.dataset.vocalist=1),n.classList.add("grow",e?"text-sm":"text-xl","text-start","font-semibold","transition-all","duration-300"),j.test(t)&&n.setAttribute("dir","rtl"),a.classList.add("mx-2","cursor-pointer"),a.src=se,a.width=20,a.addEventListener("click",c=>{c.stopPropagation();const m=c.currentTarget.previousElementSibling,h=s.indexOf(c.currentTarget.parentNode);let I="";if(v.innerHTML="",o){v.appendChild(f);const y=typeof m.lastElementChild.dataset.endTime<"u";Array.from(m.children).forEach(z=>{if(I+=z.innerText,I+=z.dataset.type=="word"?" ":"<>",y){const ne=ge(z);v.appendChild(ne)}}),f.value=I.trimEnd()}else{if(typeof m.parentElement.dataset.time<"u"){const y=B();y.classList.add("w-24","my-2","mx-1","text-center","bg-zinc-800","text-zinc-100","border-zinc-800"),y.value=p(m.parentElement.dataset.time),v.appendChild(y)}f.value=m.innerText,v.appendChild(f)}$.checked=m.parentElement.dataset.type=="bg",K.disabled=h<=d,X.disabled=h<d,f.disabled=o&&h<d,fe.showModal(),A.value=h,f.focus()}),i.appendChild(n),i.appendChild(a),i}function N(){const t=me.value;W.innerHTML="",s=[],d=-1,t.split(`
`).forEach(i=>{if(o&&i.trim()=="")return;const n=J(i);W.appendChild(n),s.push(n)}),document.getElementById("syncer").classList.remove("hidden"),x(s[0]),o&&E(s[0],"selected"),g(V,!0,1),g(Z,!0,2)}ue.addEventListener("click",N);function O(t,e){t.dataset.time=e,t.addEventListener("click",()=>{typeof t.dataset.time>"u"||(r.currentTime=t.dataset.time,l.refresh())})}P.addEventListener("click",()=>{const e=s[d].children[0].children[u];typeof e?.dataset?.beginTime>"u"||(e.dataset.endTime=r.currentTime)});function Q(){const t=r.currentTime;if(o){if(d==-1&&(d++,u=-1),d==s.length)return;const e=s[d],i=e.children[0],n=i.children[u];if(u++,u>=i.childElementCount)E(e,"active"),d<=s.length-1&&(u=-1,d++,d!=s.length&&(E(s[d],"selected"),x(s[d])));else{const a=i.children[u];a.dataset.beginTime=t,a.classList.add("actived")}u==0&&(O(e,t),l.addElement(e,Number(e.dataset.time))),typeof n<"u"&&(typeof n.dataset.endTime>"u"&&(n.dataset.endTime=t),l.addElement(n,Number(n.dataset.beginTime),Number(n.dataset.endTime)-Number(n.dataset.beginTime)))}else if(d<s.length-1){d++;const e=s[d];E(e,"active"),x(e),O(e,t),l.addElement(e,Number(e.dataset.time))}}function D(t){l.removeElement(t),delete t.dataset.time,o&&Array.from(t.children[0].children).forEach(e=>{typeof e?.dataset?.beginTime>"u"||(typeof e?.dataset?.endTime<"u"&&l.removeElement(e),delete e.dataset.beginTime,delete e.dataset.endTime,e.classList.remove("actived"),e.style.animationName="")})}function _(){if(d<0)return;const t=s[d];if(o)if(u==-1&&d!=0){const e=s[d-1];E(e,"selected"),x(e),r.currentTime=Math.max(0,e.dataset.time-1.5),D(e),d!=s.length&&E(t,"normal"),d--}else u!=-1&&(r.currentTime=Math.max(0,t.dataset.time-1.5),D(t),u=-1);else{const e=s[d-1];d--,x(d==-1?s[0]:e),r.currentTime=Math.max(0,t.dataset.time-1.5),E(t,"normal"),D(t)}l.refresh()}window.addEventListener("keydown",t=>{t.code==="Space"&&!["INPUT","TEXTAREA"].includes(document.activeElement.nodeName)&&(t.preventDefault(),t.shiftKey?_():L.files.length==0?L.click():s.length==0?N():Q())});V.addEventListener("click",Q);Z.addEventListener("click",_);function ee(t){t.dataset.vocalist==1?(t.dataset.vocalist=2,t.children[0].classList.remove("text-start"),t.children[0].classList.add("text-end")):(t.dataset.vocalist=1,t.children[0].classList.remove("text-end"),t.children[0].classList.add("text-start"))}w.addEventListener("click",()=>{s.length!=0&&s.slice(Math.max(0,d)).forEach(t=>{ee(t)})});document.getElementById("playbackSpeed").addEventListener("change",t=>{r.playbackRate=t.target.selectedOptions[0].value,l.refresh()});function te(t){const e=Number(A.value),i=J(f.value,$.checked);s[e].dataset.vocalist==2&&ee(i),t?(s[e].insertAdjacentElement("beforebegin",i),s.splice(e,0,i)):(s[e].insertAdjacentElement("afterend",i),s.splice(e+1,0,i))}K.addEventListener("click",()=>te(!0));X.addEventListener("click",()=>te(!1));he.addEventListener("click",()=>{const t=A.value;s[t].classList.add("hidden"),s.splice(t,1),d>=t&&(d--,d==t-1&&(u=99))});pe.addEventListener("click",()=>{const t=A.value;if(o)f.disabled?(Array.from(v.children).forEach((e,i)=>{if(e.nodeName=="TEXTAREA")return;const n=s[t].children[0].children[i-1];l.removeElement(n);const a=S(e.children[0].value),c=S(e.children[2].value);n.innerText=e.children[1].value,n.dataset.beginTime=a,n.dataset.endTime=c,l.addElement(n,a,c-a)}),s[t].dataset.time=s[t].children[0].children[0].dataset.beginTime):(s[t].children[0].innerHTML="",Y(f.value,s[t].children[0]),u=-1);else{l.removeElement(s[t]),s[t].children[0].innerText=f.value;const e=S(v.children[0].value);s[t].dataset.time=e,l.addElement(s[t],e)}$.checked?(s[t].dataset.type="bg",s[t].children[0].classList.remove("text-xl"),s[t].children[0].classList.add("text-sm")):(s[t].dataset.type="normal",s[t].children[0].classList.remove("text-sm"),s[t].children[0].classList.add("text-xl"))});function ve(t,e){const i=new Blob([e]),n=URL.createObjectURL(i),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}const Ee=document.getElementById("dlFile");Ee.addEventListener("click",()=>{if(L.files.length==0){alert("You need to select an input file first");return}const t=ae(s,o,b),i=L.files[0].name.replace(/(\.\w+?)?$/,".lrc");ve(i,t)});r.addEventListener("play",()=>{l.play(),T.firstElementChild.classList.add("hidden"),T.lastElementChild.classList.remove("hidden")});r.addEventListener("pause",()=>{l.pause(),T.firstElementChild.classList.remove("hidden"),T.lastElementChild.classList.add("hidden")});
